[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:db-init]
command=python -c "from inferia.cli_init import init_databases; init_databases()"
directory=/app
startsecs=0
exitcodes=0
autorestart=false
priority=1
stdout_logfile=/var/log/supervisor/db-init.out.log
stderr_logfile=/var/log/supervisor/db-init.err.log

[program:orchestrator-api]
command=python apps/orchestration-gateway/app.py
directory=/app
environment=PYTHONPATH="/app/package/src/inferia/services/orchestration/app:/app/apps/orchestration-gateway:/app",HTTP_PORT="8080"
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/orchestrator-api.out.log
stderr_logfile=/var/log/supervisor/orchestrator-api.err.log

[program:orchestrator-worker]
command=python package/src/inferia/services/orchestration/app/services/model_deployment/worker_main.py
directory=/app
environment=PYTHONPATH="/app/package/src/inferia/services/orchestration/app:/app"
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/orchestrator-worker.out.log
stderr_logfile=/var/log/supervisor/orchestrator-worker.err.log

[program:orchestrator-sidecar]
command=npx tsx src/server.ts
directory=/app/package/src/inferia/services/orchestration/app/services/depin-sidecar
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/sidecar.out.log
stderr_logfile=/var/log/supervisor/sidecar.err.log

[program:filtration]
command=python apps/filtration-gateway/app.py
directory=/app
environment=PYTHONPATH="/app/package/src/inferia/services/filtration:/app",PORT="8000"
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/filtration.out.log
stderr_logfile=/var/log/supervisor/filtration.err.log

[program:inference]
command=uvicorn app:app --host 0.0.0.0 --port 8001
directory=/app/apps/inference-gateway
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/inference.out.log
stderr_logfile=/var/log/supervisor/inference.err.log
